#!/bin/sh

email="$LETSENCRYPT_EMAIL"
test -z "$email" && {
  echo 'fatal: no email. set $LETSENCRYPT_EMAIL and try again.' > /dev/stderr
  exit 1
}

domain="$1"
shift
test -z "$domain" && {
  echo "usage: $0 <domains_comma_separated>" > /dev/stderr
  echo "options: --all, renew all certificates" > /dev/stderr
  exit 1
}

sudo service nginx stop
if [ "$domain" = "--all" ]; then
  bash -x certbot-auto renew \
    --no-self-upgrade
else
  bash -x certbot-auto certonly \
    --no-self-upgrade \
    --standalone \
    --domain $domain \
    --email $email $@
fi
sudo service nginx start
