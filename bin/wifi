#!/bin/bash

# get current wifi device
CURRENT_DEVICE=$(networksetup -listallhardwareports | awk '$3=="Wi-Fi" {getline; print $2}')

usage() {
    echo "usage: $0 <on|off|kick|peers|toggle>" > /dev/stderr
}

test -z "$1" && {
  usage
  exit 1
}

echo "Current Wi-Fi Device = '$CURRENT_DEVICE'"

case "$1" in
  on*)
    networksetup -setairportpower $CURRENT_DEVICE on ;;
  of*)
    networksetup -setairportpower $CURRENT_DEVICE off ;;
  t*) # toggle
    networksetup -setairportpower $CURRENT_DEVICE off
    networksetup -setairportpower $CURRENT_DEVICE on ;;
  k*) # kick
    sudo dscacheutil -flushcache
    sudo killall -HUP mDNSResponder ;;
  p*) # peers
    sudo /usr/local/bin/arp-scan \
      --interface $CURRENT_DEVICE \
      -q 192.168.0.0/24 \
      | grep '^192\.168\.0' \
      | awk '{print $2}' \
      | uniq ;;
  *)
    echo "invalid command: \"$1\"" > /dev/stderr
    usage
    exit 1
    ;;
esac
